---
import { Home, User, Tag, MapPin, Moon, Sun } from '@lucide/astro';

const pathname = Astro.url.pathname;
const isHome = pathname === '/';
const isAbout = pathname.startsWith('/about');
const isPrices = pathname.startsWith('/prices');
const isLimassol = pathname.startsWith('/web-design-limassol');
---

<nav class="navbar">
	<div class="nav-links">
		<a href="/" class={`nav-item ${isHome ? 'active' : ''}`} aria-label="Home" data-astro-prefetch="load">
			<Home size={22} />
			<span class="nav-label">Home</span>
		</a>
		<a href="/about" class={`nav-item ${isAbout ? 'active' : ''}`} aria-label="About" data-astro-prefetch="load">
			<User size={22} />
			<span class="nav-label">About</span>
		</a>
		<a href="/prices" class={`nav-item ${isPrices ? 'active' : ''}`} aria-label="Prices" data-astro-prefetch="load">
			<Tag size={22} />
			<span class="nav-label">Prices</span>
		</a>
		<a href="/web-design-limassol" class={`nav-item ${isLimassol ? 'active' : ''}`} aria-label="Limassol" data-astro-prefetch="load">
			<MapPin size={22} />
			<span class="nav-label">Limassol</span>
		</a>
	</div>
	<button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
		<span class="moon-icon"><Moon size={20} /></span>
		<span class="sun-icon"><Sun size={20} /></span>
	</button>
</nav>

<style>
	.navbar {
		position: fixed;
		left: 40px;
		top: 200px;
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 40px;
		z-index: 1000;
	}

	.nav-links {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 4px;
	}

	.nav-item {
		position: relative;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 48px;
		height: 48px;
		border-radius: 14px;
		color: rgba(30, 41, 59, 0.4);
		text-decoration: none;
		transition: all 0.3s ease;
	}

	.nav-label {
		position: absolute;
		left: 70px;
		background: #1e293b;
		color: #fff;
		padding: 6px 12px;
		border-radius: 8px;
		font-size: 13px;
		font-weight: 500;
		white-space: nowrap;
		opacity: 0;
		visibility: hidden;
		transform: translateX(-8px);
		transition: all 0.2s ease;
		pointer-events: none;
	}

	.nav-item:hover .nav-label {
		opacity: 1;
		visibility: visible;
		transform: translateX(0);
	}

	.nav-item :global(svg) {
		transition: transform 0.3s ease;
	}

	.nav-item:hover {
		color: rgba(30, 41, 59, 0.7);
		background: rgba(30, 41, 59, 0.05);
	}

	.nav-item:hover :global(svg) {
		transform: scale(1.15);
	}

	.nav-item.active {
		color: #1e293b;
		background: #fff;
		border: 1px solid rgba(0, 0, 0, 0.05);
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
	}

	.theme-toggle {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 44px;
		height: 44px;
		border: none;
		background: transparent;
		color: rgba(30, 41, 59, 0.5);
		cursor: pointer;
		transition: all 0.3s ease;
		border-radius: 12px;
	}

	.theme-toggle:hover {
		color: rgba(30, 41, 59, 0.8);
	}

	.sun-icon {
		display: none;
	}

	:global(html.dark) .moon-icon {
		display: none;
	}

	:global(html.dark) .sun-icon {
		display: block;
	}

	/* Dark mode styles */
	:global(html.dark) .nav-item {
		color: rgba(226, 232, 240, 0.4);
	}

	:global(html.dark) .nav-item:hover {
		color: rgba(226, 232, 240, 0.7);
		background: rgba(226, 232, 240, 0.05);
	}

	:global(html.dark) .nav-item.active {
		color: #e2e8f0;
		background: rgba(255, 255, 255, 0.1);
		border-color: rgba(255, 255, 255, 0.1);
	}

	:global(html.dark) .nav-label {
		background: #e2e8f0;
		color: #1a1a2e;
	}

	:global(html.dark) .theme-toggle {
		color: rgba(226, 232, 240, 0.5);
	}

	:global(html.dark) .theme-toggle:hover {
		color: rgba(226, 232, 240, 0.8);
	}

	/* Tablet responsive */
	@media (max-width: 1024px) {
		.navbar {
			left: 50%;
			transform: translateX(-50%);
			top: 20px;
			flex-direction: row;
			background: rgba(255, 255, 255, 0.9);
			backdrop-filter: blur(10px);
			padding: 8px 16px;
			border-radius: 16px;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
		}

		:global(html.dark) .navbar {
			background: rgba(26, 26, 46, 0.9);
		}

		.nav-links {
			flex-direction: row;
			padding: 4px;
			gap: 4px;
		}

		.nav-item {
			width: 44px;
			height: 44px;
		}

		.nav-label {
			display: none;
		}

		.theme-toggle {
			margin-left: 8px;
		}
	}

	/* Mobile responsive */
	@media (max-width: 768px) {
		.navbar {
			left: 50%;
			transform: translateX(-50%);
			top: 20px;
			flex-direction: row;
			padding: 6px 12px;
		}

		.nav-links {
			flex-direction: row;
			padding: 4px;
			gap: 2px;
		}

		.nav-item {
			width: 40px;
			height: 40px;
		}

		.nav-label {
			display: none;
		}

		.theme-toggle {
			width: 40px;
			height: 40px;
			margin-left: 4px;
		}
	}
</style>

<script is:inline>
	// Initialize theme from localStorage (runs immediately)
	(function() {
		const savedTheme = localStorage.getItem('theme');
		const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
		if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
			document.documentElement.classList.add('dark');
		}
	})();

	// Function to update active nav state
	function updateActiveNav() {
		const pathname = window.location.pathname;
		const navItems = document.querySelectorAll('.nav-item');
		navItems.forEach(item => {
			const href = item.getAttribute('href');
			item.classList.remove('active');
			if (href === '/' && pathname === '/') {
				item.classList.add('active');
			} else if (href !== '/' && pathname.startsWith(href)) {
				item.classList.add('active');
			}
		});
	}

	// Setup handlers (only once)
	if (!window.__navSetup) {
		window.__navSetup = true;

		// Click handler for toggle button
		document.addEventListener('click', (e) => {
			const toggle = e.target.closest('#theme-toggle');
			if (toggle) {
				document.documentElement.classList.toggle('dark');
				const isDark = document.documentElement.classList.contains('dark');
				localStorage.setItem('theme', isDark ? 'dark' : 'light');
			}
		});

		// Preserve dark mode during view transitions
		document.addEventListener('astro:before-swap', (e) => {
			const savedTheme = localStorage.getItem('theme');
			const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
				e.newDocument.documentElement.classList.add('dark');
			}
		});

		// Update active nav after page swap
		document.addEventListener('astro:after-swap', updateActiveNav);
	}
</script>
