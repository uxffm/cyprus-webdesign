---
import { Home, User, Tag, MapPin, Moon, Sun } from '@lucide/astro';

const pathname = Astro.url.pathname;
const isHome = pathname === '/';
const isAbout = pathname.startsWith('/about');
const isPrices = pathname.startsWith('/prices');
const isLimassol = pathname.startsWith('/web-design-limassol');
const isPaphos = pathname.startsWith('/web-design-paphos');
---

<nav class="navbar">
	<div class="nav-links">
		<a href="/" class={`nav-item ${isHome ? 'active' : ''}`} aria-label="Home" data-astro-prefetch="load">
			<Home size={22} />
			<span class="nav-label">Home</span>
		</a>
		<a href="/about" class={`nav-item ${isAbout ? 'active' : ''}`} aria-label="About" data-astro-prefetch="load">
			<User size={22} />
			<span class="nav-label">About</span>
		</a>
		<a href="/prices" class={`nav-item ${isPrices ? 'active' : ''}`} aria-label="Prices" data-astro-prefetch="load">
			<Tag size={22} />
			<span class="nav-label">Prices</span>
		</a>
		<a href="/web-design-limassol" class={`nav-item ${isLimassol ? 'active' : ''}`} aria-label="Limassol" data-astro-prefetch="load">
			<MapPin size={22} />
			<span class="nav-label">Limassol</span>
		</a>
		<a href="/web-design-paphos" class={`nav-item ${isPaphos ? 'active' : ''}`} aria-label="Paphos" data-astro-prefetch="load">
			<MapPin size={22} />
			<span class="nav-label">Paphos</span>
		</a>
	</div>
	<button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
		<span class="moon-icon"><Moon size={20} /></span>
		<span class="sun-icon"><Sun size={20} /></span>
	</button>
</nav>

<style>
	.navbar {
		position: fixed;
		top: 24px;
		left: 50%;
		transform: translateX(-50%);
		display: flex;
		flex-direction: row;
		align-items: center;
		gap: 8px;
		z-index: 1000;
		background: rgba(255, 255, 255, 0.7);
		backdrop-filter: blur(20px);
		-webkit-backdrop-filter: blur(20px);
		padding: 12px 20px;
		border-radius: 50px;
		border: 1px solid rgba(0, 0, 0, 0.08);
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
	}

	:global(html.dark) .navbar {
		background: rgba(26, 26, 46, 0.4);
		border-color: rgba(255, 255, 255, 0.1);
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
	}

	.nav-links {
		display: flex;
		flex-direction: row;
		align-items: center;
		gap: 4px;
	}

	.nav-item {
		position: relative;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 44px;
		height: 44px;
		border-radius: 50%;
		color: rgba(45, 55, 72, 0.6);
		text-decoration: none;
		transition: all 0.3s ease;
	}

	.nav-label {
		position: absolute;
		top: 60px;
		left: 50%;
		transform: translateX(-50%) translateY(-8px);
		background: rgba(0, 0, 0, 0.8);
		color: #fff;
		padding: 6px 12px;
		border-radius: 8px;
		font-size: 12px;
		font-weight: 500;
		white-space: nowrap;
		opacity: 0;
		visibility: hidden;
		transition: all 0.2s ease;
		pointer-events: none;
	}

	.nav-item:hover .nav-label {
		opacity: 1;
		visibility: visible;
		transform: translateX(-50%) translateY(0);
	}

	.nav-item :global(svg) {
		transition: transform 0.3s ease;
	}

	.nav-item:hover {
		color: #2d3748;
		background: rgba(0, 0, 0, 0.05);
	}

	.nav-item:hover :global(svg) {
		transform: scale(1.1);
	}

	.nav-item.active {
		color: #2d3748;
		background: rgba(0, 0, 0, 0.08);
	}

	.theme-toggle {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 44px;
		height: 44px;
		border: none;
		background: transparent;
		color: rgba(45, 55, 72, 0.6);
		cursor: pointer;
		transition: all 0.3s ease;
		border-radius: 50%;
		margin-left: 4px;
	}

	.theme-toggle:hover {
		color: #2d3748;
		background: rgba(0, 0, 0, 0.05);
	}

	.sun-icon {
		display: none;
	}

	:global(html.dark) .moon-icon {
		display: none;
	}

	:global(html.dark) .sun-icon {
		display: block;
	}

	/* Dark mode styles */
	:global(html.dark) .nav-item {
		color: rgba(226, 232, 240, 0.7);
	}

	:global(html.dark) .nav-item:hover {
		color: #fff;
		background: rgba(255, 255, 255, 0.1);
	}

	:global(html.dark) .nav-item.active {
		color: #fff;
		background: rgba(255, 255, 255, 0.15);
	}

	:global(html.dark) .nav-label {
		background: rgba(255, 255, 255, 0.9);
		color: #1a1a2e;
	}

	:global(html.dark) .theme-toggle {
		color: rgba(226, 232, 240, 0.7);
	}

	:global(html.dark) .theme-toggle:hover {
		color: #fff;
		background: rgba(255, 255, 255, 0.1);
	}

	/* Mobile responsive */
	@media (max-width: 768px) {
		.navbar {
			top: 16px;
			padding: 8px 14px;
		}

		.nav-links {
			gap: 2px;
		}

		.nav-item {
			width: 38px;
			height: 38px;
		}

		.nav-label {
			display: none;
		}

		.theme-toggle {
			width: 38px;
			height: 38px;
			margin-left: 2px;
		}
	}
</style>

<script is:inline>
	// Initialize theme from localStorage (runs immediately)
	(function() {
		const savedTheme = localStorage.getItem('theme');
		const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
		if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
			document.documentElement.classList.add('dark');
		}
	})();

	// Function to update active nav state
	function updateActiveNav() {
		const pathname = window.location.pathname;
		const navItems = document.querySelectorAll('.nav-item');
		navItems.forEach(item => {
			const href = item.getAttribute('href');
			item.classList.remove('active');
			if (href === '/' && pathname === '/') {
				item.classList.add('active');
			} else if (href !== '/' && pathname.startsWith(href)) {
				item.classList.add('active');
			}
		});
	}

	// Setup handlers (only once)
	if (!window.__navSetup) {
		window.__navSetup = true;

		// Click handler for toggle button
		document.addEventListener('click', (e) => {
			const toggle = e.target.closest('#theme-toggle');
			if (toggle) {
				document.documentElement.classList.toggle('dark');
				const isDark = document.documentElement.classList.contains('dark');
				localStorage.setItem('theme', isDark ? 'dark' : 'light');
			}
		});

		// Preserve dark mode during view transitions
		document.addEventListener('astro:before-swap', (e) => {
			const savedTheme = localStorage.getItem('theme');
			const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
				e.newDocument.documentElement.classList.add('dark');
			}
		});

		// Update active nav after page swap
		document.addEventListener('astro:after-swap', updateActiveNav);
	}
</script>
